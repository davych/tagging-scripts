{"version":3,"file":"tagging-scripts.esm.js","sources":["../src/utils.ts","../src/auth.ts","../src/infos.ts","../src/dynamic.ts","../src/push.ts","../src/pageble.ts","../src/clickable.ts","../src/helpers.ts","../src/index.ts"],"sourcesContent":["import { isObject, reduce, merge } from 'lodash';\n\nlet __TaggingConfiguration: any;\n\nexport const flattenKeys = (\n  obj: Record<string, unknown>,\n  path: string[] = []\n): Record<string, string> =>\n  !isObject(obj)\n    ? { [path.join('.')]: obj }\n    : reduce(\n        obj,\n        (cum: any, next: any, key: any) =>\n          merge(\n            cum,\n            flattenKeys(next as Record<string, unknown>, [...path, key])\n          ),\n        {}\n      );\n\nexport const replace = (str: string, obj: any) =>\n  str.replaceAll(/\\{([^}]+)\\}/gi, (_, a) =>\n    a.split('.').reduce((b: any, c: any) => b?.[c], obj)\n  );\nexport const getPictureFromDom = (domTarget: any) => {\n  const { dataset, classList = [], id } = domTarget;\n  return {\n    dataset,\n    classList,\n    id,\n  };\n};\n\nexport const getPathname = (locationInstance?: any) => {\n  const location = locationInstance || window.location;\n  const { hash } = getAppConfig();\n  if (hash) {\n    return location.hash.replace('#', '');\n  }\n  return location.pathname;\n};\n\nexport const getAppConfig = () => {\n  return __TaggingConfiguration;\n};\n\nexport const setAppConfig = (config: any) => {\n  __TaggingConfiguration = config;\n};\n\nexport const updateInfos = (infos: any) => {\n  if (!__TaggingConfiguration.infos) {\n    __TaggingConfiguration.infos = {};\n  }\n  merge(__TaggingConfiguration.infos, infos);\n};\n\nexport const updateAuth = (auth: any) => {\n  if (!__TaggingConfiguration.auth) {\n    __TaggingConfiguration.auth = {};\n  }\n  merge(__TaggingConfiguration.auth, auth);\n};\n","import * as utils from './utils';\n\nexport const getData = (): any => {\n  return utils.getAppConfig().auth || {};\n};\n","import * as utils from './utils';\n\nexport const getData = () => {\n  return utils.getAppConfig().infos || {};\n};\n","import { set, get } from 'lodash';\nlet dynamic: any = {};\n\nexport const getData = (key: string): any => {\n  return get(dynamic, key, {});\n};\n\nexport const setData = (key: string, data: any) => {\n  set(dynamic, key, data);\n};\n","import { set, get } from 'lodash';\nimport * as utils from './utils';\n\nexport const pushEvent = (scope: any, data: any) => {\n  const { eventLabel, pushTargets = {} } = utils.getAppConfig();\n  // push event\n  set(window, '__TAG_DATA__LAYER', data);\n\n  const eventName = get(scope, eventLabel, scope.type || 'event');\n\n  const targetPipe: string[] = Object.values(pushTargets);\n  targetPipe.forEach(pushFn => {\n    // new function with event name and data as arguments\n    const pushFnWithArgs = new Function('eventName', 'data', pushFn);\n    pushFnWithArgs(eventName, data);\n  });\n};\n","import * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport * as R from 'ramda';\nimport { isEmpty, merge, set } from 'lodash';\nimport * as dynamic from './dynamic';\nimport * as push from './push';\n\nexport const runJob = () => {\n  const page = getActivedPage();\n  if (!page || !isEmpty(page?.dynamicKeys)) {\n    return;\n  }\n  const output = getRuleOutput(true);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(page, output);\n};\n\nexport const runJobWithDynamicData = () => {\n  const output = getRuleOutput(true);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(getActivedPage(), output);\n};\n\nexport const findPage = R.memoizeWith(R.toUpper, (identifier: string): any => {\n  const config = utils.getAppConfig();\n  return R.find(R.propEq(identifier, 'id'))(config.pages);\n});\n\nexport const getActivedPage = () => {\n  const pathname = utils.getPathname();\n  const page = findPage(pathname);\n  if (!page) {\n    return;\n  }\n  return page;\n};\n\nexport const getActivePageTag = () => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  return page.tag;\n};\n\nexport const getRuleOutput = (decode?: boolean) => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  const { rules, tag, dynamicKeys = [] } = page;\n  const dynamicData = dynamic.getData(utils.getPathname());\n  const data = merge({}, dynamicData, tag, auth.getData(), infos.getData());\n  if (!isEmpty(dynamicKeys)) {\n    const keysOfCurrentPage = Object.keys(dynamicData);\n    const diff = R.difference(dynamicKeys, keysOfCurrentPage);\n    if (!R.isEmpty(diff)) {\n      console.warn('[page]missing dynamic keys', diff);\n    }\n  }\n  // pending runtime data\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n\n  return output;\n};\n","import * as R from 'ramda';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport { isEmpty, merge, set } from 'lodash';\nimport * as push from './push';\nimport * as dynamic from './dynamic';\n\nexport const runJob = ({ dataset = {}, classList = [], id }: any) => {\n  // get actived page\n  const page = pageble.getActivedPage();\n  if (!page) {\n    return;\n  }\n\n  // get actived button\n  const button = getTargetButton({ classList, id }, page);\n\n  if (!button) {\n    return;\n  }\n  // get page output, get button output\n  const resultOfPage = pageble.getRuleOutput() || {};\n  const resultOfButton = getRuleOutput(button, false, dataset);\n  const result = merge({}, resultOfPage, resultOfButton);\n\n  const data = {};\n  R.forEachObjIndexed((value, key) => {\n    set(data, key, value);\n  }, result);\n\n  push.pushEvent(button, data);\n};\n\nexport const getRuleOutput = (button: any, decode: boolean, dataset: any) => {\n  const { rules, tag, dynamicKeys = [] } = button;\n\n  if (!isEmpty(dynamicKeys)) {\n    const keysOfCurrentButton = Object.keys(dataset);\n    const diff = R.difference(dynamicKeys, keysOfCurrentButton);\n    if (!R.isEmpty(diff)) {\n      console.warn('[clickable]missing dynamic keys', diff);\n    }\n  }\n\n  const pageTag = pageble.getActivePageTag();\n  const dynamicData = dynamic.getData(utils.getPathname());\n  const data = merge(\n    {},\n    dynamicData,\n    dataset,\n    pageTag,\n    tag,\n    auth.getData(),\n    infos.getData()\n  );\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    if (value.startsWith('return')) {\n      const vauleFunc = new Function('data', value);\n      return vauleFunc(data);\n    }\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n  return output;\n};\n\nexport const getTargetButton = (picture: any, page?: any) => {\n  if (!page) {\n    page = pageble.getActivedPage();\n  }\n  if (!page) {\n    return;\n  }\n  const button: any = R.find(\n    R.anyPass([\n      R.propEq(picture.id, 'id'),\n      R.propSatisfies(v => picture.classList?.contains(v), 'class'),\n    ])\n  )(page.actions.clicks);\n\n  if (!button) {\n    return;\n  }\n  return button;\n};\n","import * as pageble from './pageble';\nimport * as utils from './utils';\nimport * as dynamic from './dynamic';\n\nexport const updateDynamicData = (data: any) => {\n  const pathname = utils.getPathname();\n  dynamic.setData(pathname, data);\n  // update dynamic data\n  pageble.runJobWithDynamicData();\n};\n\nexport const updateAuth = (auth: any) => {\n  utils.updateAuth(auth);\n};\n\nexport const updateInfos = (infos: any) => {\n  utils.updateInfos(infos);\n};\n","// import config from './config';\nimport { debounce } from 'lodash';\nimport * as clickable from './clickable';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\nimport * as tagHelpers from './helpers';\n\nconst taggingRun = (__TaggingConfiguration: any) => {\n  if (__TaggingConfiguration) {\n    console.log('Tagging is running');\n    utils.setAppConfig(__TaggingConfiguration);\n    var pushState = window.history.pushState;\n    window.history.pushState = function() {\n      const beforeIdentifier = utils.getPathname(window.location);\n      pushState.apply(window.history, arguments as any);\n      const afterIdentifier = utils.getPathname(window.location);\n      if (beforeIdentifier !== afterIdentifier) {\n        debounce(pageble.runJob, 100)();\n      }\n    };\n\n    window.addEventListener('popstate', () => {\n      pageble.runJob();\n    });\n\n    document.addEventListener(\n      'click',\n      e => {\n        clickable.runJob(utils.getPictureFromDom(e.target));\n      },\n      true\n    );\n  }\n};\n\nexport default taggingRun;\nexport { tagHelpers };\n"],"names":["__TaggingConfiguration","flattenKeys","obj","path","isObject","_ref","join","reduce","cum","next","key","merge","concat","replace","str","replaceAll","_","a","split","b","c","getPictureFromDom","domTarget","dataset","_domTarget$classList","classList","id","getPathname","locationInstance","location","window","_getAppConfig","getAppConfig","hash","pathname","setAppConfig","config","updateInfos","infos","updateAuth","auth","getData","utils","dynamic","get","setData","data","set","pushEvent","scope","_utils$getAppConfig","eventLabel","_utils$getAppConfig$p","pushTargets","eventName","type","targetPipe","Object","values","forEach","pushFn","pushFnWithArgs","Function","runJob","page","getActivedPage","isEmpty","dynamicKeys","output","getRuleOutput","push","runJobWithDynamicData","findPage","R","identifier","pages","getActivePageTag","tag","decode","rules","_page$dynamicKeys","dynamicData","keysOfCurrentPage","keys","diff","console","warn","flattenRules","value","decodeOutput","_ref$dataset","_ref$classList","pageble","button","getTargetButton","resultOfPage","resultOfButton","result","_button$dynamicKeys","keysOfCurrentButton","pageTag","startsWith","vauleFunc","picture","v","_picture$classList","contains","actions","clicks","updateDynamicData","taggingRun","log","pushState","history","beforeIdentifier","apply","arguments","afterIdentifier","debounce","addEventListener","document","e","clickable","target"],"mappings":"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"}