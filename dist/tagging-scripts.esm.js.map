{"version":3,"file":"tagging-scripts.esm.js","sources":["../src/config.ts","../src/utils.ts","../src/auth.ts","../src/infos.ts","../src/dynamic.ts","../src/push.ts","../src/pageble.ts","../src/clickable.ts","../src/index.ts"],"sourcesContent":["export default {\n  name: 'app-name',\n  pushTargets: {\n    gtm: 'return dataLayer.push({event: eventName, ...data});',\n  },\n  eventLabel: 'event',\n  auth: {\n    // not sure how many data under auth, this is dynamic setted by develoer\n  },\n  infos: {\n    // this is same as auth\n    region: 'cn',\n  },\n  pages: [\n    {\n      tag: {\n        // this is tag data, all of this tag data are static setted by developer\n        // tag data is a picture of page\n        name: 'this-is-home',\n        section: 'footer',\n      },\n      name: 'xxxxxxx',\n      meta: {},\n      id: '/page2',\n      event: 'page__view',\n      type: 'page',\n      dynamicKeys: ['aaa'],\n      rules: {\n        // this is rules data, all of this rules data are static setted by developer\n        page: {\n          pageName: '{name}:{region}',\n          section: '{name}:{region}-{section}+{aaa}',\n        },\n      },\n      actions: {\n        clicks: [\n          {\n            tag: {\n              buttonName: 'hello-click',\n            },\n            type: 'click',\n            event: 'button__click',\n            meta: {},\n            rules: {\n              button: {\n                buttonName: '{name}:{region}-{buttonName}:{cardname}',\n              },\n            },\n            dynamicKeys: ['cardname'],\n            id: 'domid',\n            class: 'domclass',\n          },\n        ],\n        toggle: [\n          {\n            tag: {},\n            event: 'toggle',\n            id: 'domid',\n            class: 'domclass',\n            type: 'toggle',\n          },\n        ],\n        errors: [\n          {\n            tag: {},\n            event: 'http_error',\n            type: 'http_error',\n          },\n          {\n            tag: {},\n            event: 'form_error',\n            id: 'domid',\n            class: 'domclass',\n            type: 'form_error',\n          },\n        ],\n      },\n    },\n  ],\n};\n","import { isObject, reduce, merge } from 'lodash';\n\nexport const flattenKeys = (\n  obj: Record<string, unknown>,\n  path: string[] = []\n): Record<string, string> =>\n  !isObject(obj)\n    ? { [path.join('.')]: obj }\n    : reduce(\n        obj,\n        (cum: any, next: any, key: any) =>\n          merge(\n            cum,\n            flattenKeys(next as Record<string, unknown>, [...path, key])\n          ),\n        {}\n      );\n\nexport const replace = (str: string, obj: any) =>\n  str.replaceAll(/\\{([^}]+)\\}/gi, (_, a) =>\n    a.split('.').reduce((b: any, c: any) => b?.[c], obj)\n  );\nexport const getPictureFromDom = (domTarget: any) => {\n  const { dataset, classList = [], id } = domTarget;\n  return {\n    dataset,\n    classList,\n    id,\n  };\n};\n\nexport const getPathname = (locationInstance?: any) => {\n  const location = locationInstance || window.location;\n  const { hash } = getAppConfig();\n  if (hash) {\n    return location.hash.replace('#', '');\n  }\n  return location.pathname;\n};\n\nexport const getAppConfig = () => {\n  return window.__TaggingConfiguration;\n};\n","import * as utils from './utils';\n\nlet auth: any;\n\nexport const getData = (): any => {\n  return auth || utils.getAppConfig().auth || {};\n};\n\nexport const setData = (data: any) => {\n  auth = data;\n};\n","import * as utils from './utils';\n\nlet infos: any;\n\nexport const getData = () => {\n  return infos || utils.getAppConfig().infos || {};\n};\n\nexport const setData = (data: any) => {\n  infos = data;\n};\n","import { set, get } from 'lodash';\nlet dynamic: any = {};\n\nexport const getData = (key: string): any => {\n  return get(dynamic, key, {});\n};\n\nexport const setData = (key: string, data: any) => {\n  set(dynamic, key, data);\n};\n","import { set, get } from 'lodash';\nimport * as utils from './utils';\n\nexport const pushEvent = (scope: any, data: any) => {\n  const { eventLabel, pushTargets = {} } = utils.getAppConfig();\n  // push event\n  set(window, '__TAG_DATA__LAYER', data);\n\n  const eventName = get(scope, eventLabel, scope.type || 'event');\n\n  const targetPipe: string[] = Object.values(pushTargets);\n  targetPipe.forEach(pushFn => {\n    // new function with event name and data as arguments\n    const pushFnWithArgs = new Function('eventName', 'data', pushFn);\n    pushFnWithArgs(eventName, data);\n  });\n};\n","import * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport * as R from 'ramda';\nimport { isEmpty, merge, set } from 'lodash';\nimport * as dynamic from './dynamic';\nimport * as push from './push';\n\nexport const runJob = () => {\n  const page = getActivedPage();\n  if (!page || !isEmpty(page?.dynamicKeys)) {\n    return;\n  }\n  const output = getRuleOutput(true);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(page, output);\n};\n\nexport const runJobWithDynamicData = () => {\n  const output = getRuleOutput(true);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(getActivedPage(), output);\n};\n\nexport const findPage = R.memoizeWith(R.toUpper, (identifier: string): any => {\n  return R.find(R.propEq(identifier, 'id'))(\n    window.__TaggingConfiguration.pages\n  );\n});\n\nexport const getActivedPage = () => {\n  const pathname = utils.getPathname();\n  const page = findPage(pathname);\n  if (!page) {\n    return;\n  }\n  return page;\n};\n\nexport const getActivePageTag = () => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  return page.tag;\n};\n\nexport const getRuleOutput = (decode?: boolean) => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  const { rules, tag, dynamicKeys } = page;\n  const dynamicData = dynamic.getData(utils.getPathname());\n  const data = merge({}, dynamicData, tag, auth.getData(), infos.getData());\n  if (!R.isEmpty(dynamicKeys)) {\n    const keysOfCurrentPage = Object.keys(dynamicData);\n    const diff = R.difference(dynamicKeys, keysOfCurrentPage);\n    if (!R.isEmpty(diff)) {\n      console.warn('[page]missing dynamic keys', diff);\n    }\n  }\n  // pending runtime data\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n\n  return output;\n};\n","import * as R from 'ramda';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport { merge, set } from 'lodash';\nimport * as push from './push';\n\nexport const runJob = ({ dataset = {}, classList, id }: any) => {\n  // get actived page\n  const page = pageble.getActivedPage();\n  if (!page) {\n    return;\n  }\n\n  // get actived button\n  const button = getTargetButton({ classList, id }, page);\n\n  if (!button) {\n    return;\n  }\n  // get page output, get button output\n  const resultOfPage = pageble.getRuleOutput() || {};\n  const resultOfButton = getRuleOutput(button, false, dataset);\n  const result = merge({}, resultOfPage, resultOfButton);\n\n  const data = {};\n  R.forEachObjIndexed((value, key) => {\n    set(data, key, value);\n  }, result);\n\n  push.pushEvent(button, data);\n};\n\nexport const getRuleOutput = (button: any, decode: boolean, dataset: any) => {\n  const { rules, tag, dynamicKeys } = button;\n\n  if (!R.isEmpty(dynamicKeys)) {\n    const keysOfCurrentButton = Object.keys(dataset);\n    const diff = R.difference(dynamicKeys, keysOfCurrentButton);\n    if (!R.isEmpty(diff)) {\n      console.warn('[clickable]missing dynamic keys', diff);\n    }\n  }\n\n  const pageTag = pageble.getActivePageTag();\n  const data = merge(\n    {},\n    dataset,\n    pageTag,\n    tag,\n    auth.getData(),\n    infos.getData()\n  );\n  // pending runtime data\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n  return output;\n};\n\nexport const getTargetButton = (picture: any, page?: any) => {\n  if (!page) {\n    page = pageble.getActivedPage();\n  }\n  if (!page) {\n    return;\n  }\n  const button: any = R.find(\n    R.anyPass([\n      R.propEq(picture.id, 'id'),\n      R.propSatisfies(v => picture.classList?.contains(v), 'class'),\n    ])\n  )(page.actions.clicks);\n\n  if (!button) {\n    return;\n  }\n  return button;\n};\n","import config from './config';\nimport * as clickable from './clickable';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\n\nwindow.__TaggingConfiguration = config;\n\n(() => {\n  if (window.__TaggingConfiguration) {\n    console.log('Tagging is running');\n\n    var pushState = window.history.pushState;\n    window.history.pushState = function() {\n      const beforeIdentifier = utils.getPathname(window.location);\n      pushState.apply(window.history, arguments as any);\n      const afterIdentifier = utils.getPathname(window.location);\n      if (beforeIdentifier !== afterIdentifier) {\n        pageble.runJob();\n      }\n    };\n\n    window.addEventListener('popstate', () => {\n      pageble.runJob();\n    });\n\n    document.addEventListener(\n      'click',\n      e => {\n        clickable.runJob(utils.getPictureFromDom(e.target));\n      },\n      true\n    );\n  }\n})();\n"],"names":["name","pushTargets","gtm","eventLabel","auth","infos","region","pages","tag","section","meta","id","event","type","dynamicKeys","rules","page","pageName","actions","clicks","buttonName","button","toggle","errors","flattenKeys","obj","path","isObject","_ref","join","reduce","cum","next","key","merge","concat","replace","str","replaceAll","_","a","split","b","c","getPictureFromDom","domTarget","dataset","_domTarget$classList","classList","getPathname","locationInstance","location","window","_getAppConfig","getAppConfig","hash","pathname","__TaggingConfiguration","getData","utils","dynamic","get","pushEvent","scope","data","_utils$getAppConfig","_utils$getAppConfig$p","set","eventName","targetPipe","Object","values","forEach","pushFn","pushFnWithArgs","Function","runJob","getActivedPage","isEmpty","output","getRuleOutput","push","findPage","R","identifier","getActivePageTag","decode","dynamicData","keysOfCurrentPage","keys","diff","console","warn","flattenRules","value","decodeOutput","_ref$dataset","pageble","getTargetButton","resultOfPage","resultOfButton","result","keysOfCurrentButton","pageTag","picture","v","_picture$classList","contains","config","log","pushState","history","beforeIdentifier","apply","arguments","afterIdentifier","addEventListener","document","e","clickable","target"],"mappings":"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"}