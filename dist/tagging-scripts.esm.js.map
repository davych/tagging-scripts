{"version":3,"file":"tagging-scripts.esm.js","sources":["../src/utils.ts","../src/auth.ts","../src/infos.ts","../src/dynamic.ts","../src/push.ts","../src/pageble.ts","../src/clickable.ts","../src/index.ts"],"sourcesContent":["import { isObject, reduce, merge } from 'lodash';\n\nlet __TaggingConfiguration: any;\n\nexport const flattenKeys = (\n  obj: Record<string, unknown>,\n  path: string[] = []\n): Record<string, string> =>\n  !isObject(obj)\n    ? { [path.join('.')]: obj }\n    : reduce(\n        obj,\n        (cum: any, next: any, key: any) =>\n          merge(\n            cum,\n            flattenKeys(next as Record<string, unknown>, [...path, key])\n          ),\n        {}\n      );\n\nexport const replace = (str: string, obj: any) =>\n  str.replaceAll(/\\{([^}]+)\\}/gi, (_, a) =>\n    a.split('.').reduce((b: any, c: any) => b?.[c], obj)\n  );\nexport const getPictureFromDom = (domTarget: any) => {\n  const { dataset, classList = [], id } = domTarget;\n  return {\n    dataset,\n    classList,\n    id,\n  };\n};\n\nexport const getPathname = (locationInstance?: any) => {\n  const location = locationInstance || window.location;\n  const { hash } = getAppConfig();\n  if (hash) {\n    return location.hash.replace('#', '');\n  }\n  return location.pathname;\n};\n\nexport const getAppConfig = () => {\n  return __TaggingConfiguration;\n};\n\nexport const setAppConfig = (config: any) => {\n  __TaggingConfiguration = config;\n};\n","import * as utils from './utils';\n\nlet auth: any;\n\nexport const getData = (): any => {\n  return auth || utils.getAppConfig().auth || {};\n};\n\nexport const setData = (data: any) => {\n  auth = data;\n};\n","import * as utils from './utils';\n\nlet infos: any;\n\nexport const getData = () => {\n  return infos || utils.getAppConfig().infos || {};\n};\n\nexport const setData = (data: any) => {\n  infos = data;\n};\n","import { set, get } from 'lodash';\nlet dynamic: any = {};\n\nexport const getData = (key: string): any => {\n  return get(dynamic, key, {});\n};\n\nexport const setData = (key: string, data: any) => {\n  set(dynamic, key, data);\n};\n","import { set, get } from 'lodash';\nimport * as utils from './utils';\n\nexport const pushEvent = (scope: any, data: any) => {\n  const { eventLabel, pushTargets = {} } = utils.getAppConfig();\n  // push event\n  set(window, '__TAG_DATA__LAYER', data);\n\n  const eventName = get(scope, eventLabel, scope.type || 'event');\n\n  const targetPipe: string[] = Object.values(pushTargets);\n  targetPipe.forEach(pushFn => {\n    // new function with event name and data as arguments\n    const pushFnWithArgs = new Function('eventName', 'data', pushFn);\n    pushFnWithArgs(eventName, data);\n  });\n};\n","import * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport * as R from 'ramda';\nimport { isEmpty, merge, set } from 'lodash';\nimport * as dynamic from './dynamic';\nimport * as push from './push';\n\nexport const runJob = () => {\n  console.log('runJob-pageview');\n  const page = getActivedPage();\n  console.log('getActivedPage runJob-pageview', page);\n  if (!page || !isEmpty(page?.dynamicKeys)) {\n    return;\n  }\n  const output = getRuleOutput(true);\n  console.log('output runJob-pageview', output);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(page, output);\n};\n\nexport const runJobWithDynamicData = () => {\n  const output = getRuleOutput(true);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(getActivedPage(), output);\n};\n\nexport const findPage = R.memoizeWith(R.toUpper, (identifier: string): any => {\n  const config = utils.getAppConfig();\n  return R.find(R.propEq(identifier, 'id'))(config.pages);\n});\n\nexport const getActivedPage = () => {\n  const pathname = utils.getPathname();\n  console.log('getActivedPage pathname', pathname);\n  const page = findPage(pathname);\n  console.log('findPage page', page);\n  if (!page) {\n    return;\n  }\n  return page;\n};\n\nexport const getActivePageTag = () => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  return page.tag;\n};\n\nexport const getRuleOutput = (decode?: boolean) => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  const { rules, tag, dynamicKeys } = page;\n  const dynamicData = dynamic.getData(utils.getPathname());\n  const data = merge({}, dynamicData, tag, auth.getData(), infos.getData());\n  if (!R.isEmpty(dynamicKeys)) {\n    const keysOfCurrentPage = Object.keys(dynamicData);\n    const diff = R.difference(dynamicKeys, keysOfCurrentPage);\n    if (!R.isEmpty(diff)) {\n      console.warn('[page]missing dynamic keys', diff);\n    }\n  }\n  // pending runtime data\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n\n  return output;\n};\n","import * as R from 'ramda';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport { merge, set } from 'lodash';\nimport * as push from './push';\n\nexport const runJob = ({ dataset = {}, classList, id }: any) => {\n  // get actived page\n  const page = pageble.getActivedPage();\n  if (!page) {\n    return;\n  }\n\n  // get actived button\n  const button = getTargetButton({ classList, id }, page);\n\n  if (!button) {\n    return;\n  }\n  // get page output, get button output\n  const resultOfPage = pageble.getRuleOutput() || {};\n  const resultOfButton = getRuleOutput(button, false, dataset);\n  const result = merge({}, resultOfPage, resultOfButton);\n\n  const data = {};\n  R.forEachObjIndexed((value, key) => {\n    set(data, key, value);\n  }, result);\n\n  push.pushEvent(button, data);\n};\n\nexport const getRuleOutput = (button: any, decode: boolean, dataset: any) => {\n  const { rules, tag, dynamicKeys } = button;\n\n  if (!R.isEmpty(dynamicKeys)) {\n    const keysOfCurrentButton = Object.keys(dataset);\n    const diff = R.difference(dynamicKeys, keysOfCurrentButton);\n    if (!R.isEmpty(diff)) {\n      console.warn('[clickable]missing dynamic keys', diff);\n    }\n  }\n\n  const pageTag = pageble.getActivePageTag();\n  const data = merge(\n    {},\n    dataset,\n    pageTag,\n    tag,\n    auth.getData(),\n    infos.getData()\n  );\n  // pending runtime data\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n  return output;\n};\n\nexport const getTargetButton = (picture: any, page?: any) => {\n  if (!page) {\n    page = pageble.getActivedPage();\n  }\n  if (!page) {\n    return;\n  }\n  const button: any = R.find(\n    R.anyPass([\n      R.propEq(picture.id, 'id'),\n      R.propSatisfies(v => picture.classList?.contains(v), 'class'),\n    ])\n  )(page.actions.clicks);\n\n  if (!button) {\n    return;\n  }\n  return button;\n};\n","// import config from './config';\nimport * as clickable from './clickable';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\n\nconst taggingRun = (__TaggingConfiguration: any) => {\n  if (__TaggingConfiguration) {\n    console.log('Tagging is running');\n    utils.setAppConfig(__TaggingConfiguration);\n    var pushState = window.history.pushState;\n    window.history.pushState = function() {\n      const beforeIdentifier = utils.getPathname(window.location);\n      pushState.apply(window.history, arguments as any);\n      const afterIdentifier = utils.getPathname(window.location);\n      if (beforeIdentifier !== afterIdentifier) {\n        pageble.runJob();\n      }\n    };\n\n    window.addEventListener('popstate', () => {\n      pageble.runJob();\n    });\n\n    document.addEventListener(\n      'click',\n      e => {\n        clickable.runJob(utils.getPictureFromDom(e.target));\n      },\n      true\n    );\n  }\n};\n\nexport default taggingRun;\n"],"names":["__TaggingConfiguration","flattenKeys","obj","path","isObject","_ref","join","reduce","cum","next","key","merge","concat","replace","str","replaceAll","_","a","split","b","c","getPictureFromDom","domTarget","dataset","_domTarget$classList","classList","id","getPathname","locationInstance","location","window","_getAppConfig","getAppConfig","hash","pathname","setAppConfig","config","getData","auth","utils","infos","dynamic","get","pushEvent","scope","data","_utils$getAppConfig","eventLabel","_utils$getAppConfig$p","pushTargets","set","eventName","type","targetPipe","Object","values","forEach","pushFn","pushFnWithArgs","Function","runJob","console","log","page","getActivedPage","isEmpty","dynamicKeys","output","getRuleOutput","push","findPage","R","identifier","pages","getActivePageTag","tag","decode","rules","dynamicData","keysOfCurrentPage","keys","diff","warn","flattenRules","value","decodeOutput","_ref$dataset","pageble","button","getTargetButton","resultOfPage","resultOfButton","result","keysOfCurrentButton","pageTag","picture","v","_picture$classList","contains","actions","clicks","taggingRun","pushState","history","beforeIdentifier","apply","arguments","afterIdentifier","addEventListener","document","e","clickable","target"],"mappings":";;;AAEA,IAAIA,sBAA2B;AAExB,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CACtBC,GAA4B,EAC5BC;;MAAAA;IAAAA,OAAiB,EAAE;;EAAA,OAEnB,CAACC,QAAQ,CAACF,GAAG,CAAC,IAAAG,IAAA,OAAAA,IAAA,CACPF,IAAI,CAACG,IAAI,CAAC,GAAG,CAAC,IAAGJ,GAAG,EAAAG,IAAA,IACvBE,MAAM,CACJL,GAAG,EACH,UAACM,GAAQ,EAAEC,IAAS,EAAEC,GAAQ;IAAA,OAC5BC,KAAK,CACHH,GAAG,EACHP,WAAW,CAACQ,IAA+B,KAAAG,MAAA,CAAMT,IAAI,GAAEO,GAAG,GAAE,CAC7D;KACH,EAAE,CACH;AAAA;AAEA,IAAMG,OAAO,GAAG,SAAVA,OAAOA,CAAIC,GAAW,EAAEZ,GAAQ;EAAA,OAC3CY,GAAG,CAACC,UAAU,CAAC,eAAe,EAAE,UAACC,CAAC,EAAEC,CAAC;IAAA,OACnCA,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAACX,MAAM,CAAC,UAACY,CAAM,EAAEC,CAAM;MAAA,OAAKD,CAAC,oBAADA,CAAC,CAAGC,CAAC,CAAC;OAAElB,GAAG,CAAC;IACrD;AAAA;AACI,IAAMmB,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAIC,SAAc;EAC9C,IAAQC,OAAO,GAAyBD,SAAS,CAAzCC,OAAO;IAAAC,oBAAA,GAAyBF,SAAS,CAAhCG,SAAS;IAATA,SAAS,GAAAD,oBAAA,cAAG,EAAE,GAAAA,oBAAA;IAAEE,EAAE,GAAKJ,SAAS,CAAhBI,EAAE;EACnC,OAAO;IACLH,OAAO,EAAPA,OAAO;IACPE,SAAS,EAATA,SAAS;IACTC,EAAE,EAAFA;GACD;AACH,CAAC;AAEM,IAAMC,WAAW,GAAG,SAAdA,WAAWA,CAAIC,gBAAsB;EAChD,IAAMC,QAAQ,GAAGD,gBAAgB,IAAIE,MAAM,CAACD,QAAQ;EACpD,IAAAE,aAAA,GAAiBC,YAAY,EAAE;IAAvBC,IAAI,GAAAF,aAAA,CAAJE,IAAI;EACZ,IAAIA,IAAI,EAAE;IACR,OAAOJ,QAAQ,CAACI,IAAI,CAACpB,OAAO,CAAC,GAAG,EAAE,EAAE,CAAC;;EAEvC,OAAOgB,QAAQ,CAACK,QAAQ;AAC1B,CAAC;AAEM,IAAMF,YAAY,GAAG,SAAfA,YAAYA;EACvB,OAAOhC,sBAAsB;AAC/B,CAAC;AAEM,IAAMmC,YAAY,GAAG,SAAfA,YAAYA,CAAIC,MAAW;EACtCpC,sBAAsB,GAAGoC,MAAM;AACjC,CAAC;;AC5CM,IAAMC,OAAO,GAAG,SAAVA,OAAOA;EAClB,OAAOC,CAAQC,YAAkB,EAAE,CAACD,IAAI,IAAI,EAAE;AAChD,CAAC;;ACFM,IAAMD,SAAO,GAAG,SAAVA,OAAOA;EAClB,OAAOG,CAASD,YAAkB,EAAE,CAACC,KAAK,IAAI,EAAE;AAClD,CAAC;;ACLD,IAAIC,OAAO,GAAQ,EAAE;AAErB,AAAO,IAAMJ,SAAO,GAAG,SAAVA,OAAOA,CAAI3B,GAAW;EACjC,OAAOgC,GAAG,CAACD,OAAO,EAAE/B,GAAG,EAAE,EAAE,CAAC;AAC9B,CAAC;;ACFM,IAAMiC,SAAS,GAAG,SAAZA,SAASA,CAAIC,KAAU,EAAEC,IAAS;EAC7C,IAAAC,mBAAA,GAAyCP,YAAkB,EAAE;IAArDQ,UAAU,GAAAD,mBAAA,CAAVC,UAAU;IAAAC,qBAAA,GAAAF,mBAAA,CAAEG,WAAW;IAAXA,WAAW,GAAAD,qBAAA,cAAG,EAAE,GAAAA,qBAAA;;EAEpCE,GAAG,CAACpB,MAAM,EAAE,mBAAmB,EAAEe,IAAI,CAAC;EAEtC,IAAMM,SAAS,GAAGT,GAAG,CAACE,KAAK,EAAEG,UAAU,EAAEH,KAAK,CAACQ,IAAI,IAAI,OAAO,CAAC;EAE/D,IAAMC,UAAU,GAAaC,MAAM,CAACC,MAAM,CAACN,WAAW,CAAC;EACvDI,UAAU,CAACG,OAAO,CAAC,UAAAC,MAAM;;IAEvB,IAAMC,cAAc,GAAG,IAAIC,QAAQ,CAAC,WAAW,EAAE,MAAM,EAAEF,MAAM,CAAC;IAChEC,cAAc,CAACP,SAAS,EAAEN,IAAI,CAAC;GAChC,CAAC;AACJ,CAAC;;ACRM,IAAMe,MAAM,GAAG,SAATA,MAAMA;EACjBC,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;EAC9B,IAAMC,IAAI,GAAGC,cAAc,EAAE;EAC7BH,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEC,IAAI,CAAC;EACnD,IAAI,CAACA,IAAI,IAAI,CAACE,OAAO,CAACF,IAAI,oBAAJA,IAAI,CAAEG,WAAW,CAAC,EAAE;IACxC;;EAEF,IAAMC,MAAM,GAAGC,aAAa,CAAC,IAAI,CAAC;EAClCP,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEK,MAAM,CAAC;EAC7C,IAAIF,OAAO,CAACE,MAAM,CAAC,EAAE;IACnB;;EAEFE,SAAc,CAACN,IAAI,EAAEI,MAAM,CAAC;AAC9B,CAAC;AAED,AAQO,IAAMG,QAAQ,gBAAGC,WAAa,CAACA,OAAS,EAAE,UAACC,UAAkB;EAClE,IAAMpC,MAAM,GAAGG,YAAkB,EAAE;EACnC,OAAOgC,IAAM,CAACA,MAAQ,CAACC,UAAU,EAAE,IAAI,CAAC,CAAC,CAACpC,MAAM,CAACqC,KAAK,CAAC;AACzD,CAAC,CAAC;AAEF,AAAO,IAAMT,cAAc,GAAG,SAAjBA,cAAcA;EACzB,IAAM9B,QAAQ,GAAGK,WAAiB,EAAE;EACpCsB,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAE5B,QAAQ,CAAC;EAChD,IAAM6B,IAAI,GAAGO,QAAQ,CAACpC,QAAQ,CAAC;EAC/B2B,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEC,IAAI,CAAC;EAClC,IAAI,CAACA,IAAI,EAAE;IACT;;EAEF,OAAOA,IAAI;AACb,CAAC;AAED,AAAO,IAAMW,gBAAgB,GAAG,SAAnBA,gBAAgBA;EAC3B,IAAMX,IAAI,GAAGC,cAAc,EAAE;EAC7B,IAAI,CAACD,IAAI,EAAE;IACT;;EAEF,OAAOA,IAAI,CAACY,GAAG;AACjB,CAAC;AAED,AAAO,IAAMP,aAAa,GAAG,SAAhBA,aAAaA,CAAIQ,MAAgB;EAC5C,IAAMb,IAAI,GAAGC,cAAc,EAAE;EAC7B,IAAI,CAACD,IAAI,EAAE;IACT;;EAEF,IAAQc,KAAK,GAAuBd,IAAI,CAAhCc,KAAK;IAAEF,GAAG,GAAkBZ,IAAI,CAAzBY,GAAG;IAAET,WAAW,GAAKH,IAAI,CAApBG,WAAW;EAC/B,IAAMY,WAAW,GAAGrC,SAAe,CAACF,WAAiB,EAAE,CAAC;EACxD,IAAMM,IAAI,GAAGlC,KAAK,CAAC,EAAE,EAAEmE,WAAW,EAAEH,GAAG,EAAErC,OAAY,EAAE,EAAEE,SAAa,EAAE,CAAC;EACzE,IAAI,CAAC+B,SAAS,CAACL,WAAW,CAAC,EAAE;IAC3B,IAAMa,iBAAiB,GAAGzB,MAAM,CAAC0B,IAAI,CAACF,WAAW,CAAC;IAClD,IAAMG,IAAI,GAAGV,UAAY,CAACL,WAAW,EAAEa,iBAAiB,CAAC;IACzD,IAAI,CAACR,SAAS,CAACU,IAAI,CAAC,EAAE;MACpBpB,OAAO,CAACqB,IAAI,CAAC,4BAA4B,EAAED,IAAI,CAAC;;;;EAIpD,IAAME,YAAY,GAAG5C,WAAiB,CAACsC,KAAK,CAAC;EAC7C,IAAMV,MAAM,GAAGI,aAAe,CAAC,UAAAa,KAAK;IAClC,OAAO7C,OAAa,CAAC6C,KAAK,EAAEvC,IAAI,CAAC;GAClC,EAAEsC,YAAY,CAAC;EAEhB,IAAIP,MAAM,EAAE;IACV,IAAMS,YAAY,GAAG,EAAE;IACvBd,iBAAmB,CAAC,UAACa,KAAK,EAAE1E,GAAG;MAC7BwC,GAAG,CAACmC,YAAY,EAAE3E,GAAG,EAAE0E,KAAK,CAAC;KAC9B,EAAEjB,MAAM,CAAC;IACV,OAAOkB,YAAY;;EAGrB,OAAOlB,MAAM;AACf,CAAC;;AC7EM,IAAMP,QAAM,GAAG,SAATA,MAAMA,CAAAvD,IAAA;0BAAMkB,OAAO;IAAPA,OAAO,GAAA+D,YAAA,cAAG,EAAE,GAAAA,YAAA;IAAE7D,SAAS,GAAApB,IAAA,CAAToB,SAAS;IAAEC,EAAE,GAAArB,IAAA,CAAFqB,EAAE;;EAElD,IAAMqC,IAAI,GAAGwB,cAAsB,EAAE;EACrC,IAAI,CAACxB,IAAI,EAAE;IACT;;;EAIF,IAAMyB,MAAM,GAAGC,eAAe,CAAC;IAAEhE,SAAS,EAATA,SAAS;IAAEC,EAAE,EAAFA;GAAI,EAAEqC,IAAI,CAAC;EAEvD,IAAI,CAACyB,MAAM,EAAE;IACX;;;EAGF,IAAME,YAAY,GAAGH,aAAqB,EAAE,IAAI,EAAE;EAClD,IAAMI,cAAc,GAAGvB,eAAa,CAACoB,MAAM,EAAE,KAAK,EAAEjE,OAAO,CAAC;EAC5D,IAAMqE,MAAM,GAAGjF,KAAK,CAAC,EAAE,EAAE+E,YAAY,EAAEC,cAAc,CAAC;EAEtD,IAAM9C,IAAI,GAAG,EAAE;EACf0B,iBAAmB,CAAC,UAACa,KAAK,EAAE1E,GAAG;IAC7BwC,GAAG,CAACL,IAAI,EAAEnC,GAAG,EAAE0E,KAAK,CAAC;GACtB,EAAEQ,MAAM,CAAC;EAEVvB,SAAc,CAACmB,MAAM,EAAE3C,IAAI,CAAC;AAC9B,CAAC;AAED,AAAO,IAAMuB,eAAa,GAAG,SAAhBA,aAAaA,CAAIoB,MAAW,EAAEZ,MAAe,EAAErD,OAAY;EACtE,IAAQsD,KAAK,GAAuBW,MAAM,CAAlCX,KAAK;IAAEF,GAAG,GAAkBa,MAAM,CAA3Bb,GAAG;IAAET,WAAW,GAAKsB,MAAM,CAAtBtB,WAAW;EAE/B,IAAI,CAACK,SAAS,CAACL,WAAW,CAAC,EAAE;IAC3B,IAAM2B,mBAAmB,GAAGvC,MAAM,CAAC0B,IAAI,CAACzD,OAAO,CAAC;IAChD,IAAM0D,IAAI,GAAGV,UAAY,CAACL,WAAW,EAAE2B,mBAAmB,CAAC;IAC3D,IAAI,CAACtB,SAAS,CAACU,IAAI,CAAC,EAAE;MACpBpB,OAAO,CAACqB,IAAI,CAAC,iCAAiC,EAAED,IAAI,CAAC;;;EAIzD,IAAMa,OAAO,GAAGP,gBAAwB,EAAE;EAC1C,IAAM1C,IAAI,GAAGlC,KAAK,CAChB,EAAE,EACFY,OAAO,EACPuE,OAAO,EACPnB,GAAG,EACHrC,OAAY,EAAE,EACdE,SAAa,EAAE,CAChB;;EAED,IAAM2C,YAAY,GAAG5C,WAAiB,CAACsC,KAAK,CAAC;EAC7C,IAAMV,MAAM,GAAGI,aAAe,CAAC,UAAAa,KAAK;IAClC,OAAO7C,OAAa,CAAC6C,KAAK,EAAEvC,IAAI,CAAC;GAClC,EAAEsC,YAAY,CAAC;EAEhB,IAAIP,MAAM,EAAE;IACV,IAAMS,YAAY,GAAG,EAAE;IACvBd,iBAAmB,CAAC,UAACa,KAAK,EAAE1E,GAAG;MAC7BwC,GAAG,CAACmC,YAAY,EAAE3E,GAAG,EAAE0E,KAAK,CAAC;KAC9B,EAAEjB,MAAM,CAAC;IACV,OAAOkB,YAAY;;EAErB,OAAOlB,MAAM;AACf,CAAC;AAED,AAAO,IAAMsB,eAAe,GAAG,SAAlBA,eAAeA,CAAIM,OAAY,EAAEhC,IAAU;EACtD,IAAI,CAACA,IAAI,EAAE;IACTA,IAAI,GAAGwB,cAAsB,EAAE;;EAEjC,IAAI,CAACxB,IAAI,EAAE;IACT;;EAEF,IAAMyB,MAAM,GAAQjB,IAAM,CACxBA,OAAS,CAAC,CACRA,MAAQ,CAACwB,OAAO,CAACrE,EAAE,EAAE,IAAI,CAAC,EAC1B6C,aAAe,CAAC,UAAAyB,CAAC;IAAA,IAAAC,kBAAA;IAAA,QAAAA,kBAAA,GAAIF,OAAO,CAACtE,SAAS,qBAAjBwE,kBAAA,CAAmBC,QAAQ,CAACF,CAAC,CAAC;KAAE,OAAO,CAAC,CAC9D,CAAC,CACH,CAACjC,IAAI,CAACoC,OAAO,CAACC,MAAM,CAAC;EAEtB,IAAI,CAACZ,MAAM,EAAE;IACX;;EAEF,OAAOA,MAAM;AACf,CAAC;;ACxFD;AACA,AAIA,IAAMa,UAAU,GAAG,SAAbA,UAAUA,CAAIrG,sBAA2B;EAC7C,IAAIA,sBAAsB,EAAE;IAC1B6D,OAAO,CAACC,GAAG,CAAC,oBAAoB,CAAC;IACjCvB,YAAkB,CAACvC,sBAAsB,CAAC;IAC1C,IAAIsG,SAAS,GAAGxE,MAAM,CAACyE,OAAO,CAACD,SAAS;IACxCxE,MAAM,CAACyE,OAAO,CAACD,SAAS,GAAG;MACzB,IAAME,gBAAgB,GAAGjE,WAAiB,CAACT,MAAM,CAACD,QAAQ,CAAC;MAC3DyE,SAAS,CAACG,KAAK,CAAC3E,MAAM,CAACyE,OAAO,EAAEG,SAAgB,CAAC;MACjD,IAAMC,eAAe,GAAGpE,WAAiB,CAACT,MAAM,CAACD,QAAQ,CAAC;MAC1D,IAAI2E,gBAAgB,KAAKG,eAAe,EAAE;QACxCpB,MAAc,EAAE;;KAEnB;IAEDzD,MAAM,CAAC8E,gBAAgB,CAAC,UAAU,EAAE;MAClCrB,MAAc,EAAE;KACjB,CAAC;IAEFsB,QAAQ,CAACD,gBAAgB,CACvB,OAAO,EACP,UAAAE,CAAC;MACCC,QAAgB,CAACxE,iBAAuB,CAACuE,CAAC,CAACE,MAAM,CAAC,CAAC;KACpD,EACD,IAAI,CACL;;AAEL,CAAC;;;;"}