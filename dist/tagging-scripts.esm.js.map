{"version":3,"file":"tagging-scripts.esm.js","sources":["../src/utils.ts","../src/auth.ts","../src/infos.ts","../src/dynamic.ts","../src/push.ts","../src/pageble.ts","../src/clickable.ts","../src/index.ts"],"sourcesContent":["import { isObject, reduce, merge } from 'lodash';\n\nlet __TaggingConfiguration: any;\n\nexport const flattenKeys = (\n  obj: Record<string, unknown>,\n  path: string[] = []\n): Record<string, string> =>\n  !isObject(obj)\n    ? { [path.join('.')]: obj }\n    : reduce(\n        obj,\n        (cum: any, next: any, key: any) =>\n          merge(\n            cum,\n            flattenKeys(next as Record<string, unknown>, [...path, key])\n          ),\n        {}\n      );\n\nexport const replace = (str: string, obj: any) =>\n  str.replaceAll(/\\{([^}]+)\\}/gi, (_, a) =>\n    a.split('.').reduce((b: any, c: any) => b?.[c], obj)\n  );\nexport const getPictureFromDom = (domTarget: any) => {\n  const { dataset, classList = [], id } = domTarget;\n  return {\n    dataset,\n    classList,\n    id,\n  };\n};\n\nexport const getPathname = (locationInstance?: any) => {\n  const location = locationInstance || window.location;\n  const { hash } = getAppConfig();\n  if (hash) {\n    return location.hash.replace('#', '');\n  }\n  return location.pathname;\n};\n\nexport const getAppConfig = () => {\n  return __TaggingConfiguration;\n};\n\nexport const setAppConfig = (config: any) => {\n  __TaggingConfiguration = config;\n};\n\nexport const updateInfos = (infos: any) => {\n  if (!__TaggingConfiguration.infos) {\n    __TaggingConfiguration.infos = {};\n  }\n  merge(__TaggingConfiguration.infos, infos);\n};\n\nexport const updateAuth = (auth: any) => {\n  if (!__TaggingConfiguration.auth) {\n    __TaggingConfiguration.auth = {};\n  }\n  merge(__TaggingConfiguration.auth, auth);\n};\n","import * as utils from './utils';\n\nexport const getData = (): any => {\n  return utils.getAppConfig().auth || {};\n};\n","import * as utils from './utils';\n\nexport const getData = () => {\n  return utils.getAppConfig().infos || {};\n};\n","import { set, get } from 'lodash';\nlet dynamic: any = {};\n\nexport const getData = (key: string): any => {\n  return get(dynamic, key, {});\n};\n\nexport const setData = (key: string, data: any) => {\n  set(dynamic, key, data);\n};\n","import { set, get } from 'lodash';\nimport * as utils from './utils';\n\nexport const pushEvent = (scope: any, data: any) => {\n  const { eventLabel, pushTargets = {} } = utils.getAppConfig();\n  // push event\n  set(window, '__TAG_DATA__LAYER', data);\n\n  const eventName = get(scope, eventLabel, scope.type || 'event');\n\n  const targetPipe: string[] = Object.values(pushTargets);\n  targetPipe.forEach(pushFn => {\n    // new function with event name and data as arguments\n    const pushFnWithArgs = new Function('eventName', 'data', pushFn);\n    pushFnWithArgs(eventName, data);\n  });\n};\n","import * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport * as R from 'ramda';\nimport { isEmpty, merge, set } from 'lodash';\nimport * as dynamic from './dynamic';\nimport * as push from './push';\n\nexport const runJob = () => {\n  const page = getActivedPage();\n  if (!page || !isEmpty(page?.dynamicKeys)) {\n    return;\n  }\n  const output = getRuleOutput(true);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(page, output);\n};\n\nexport const runJobWithDynamicData = () => {\n  const output = getRuleOutput(true);\n  if (isEmpty(output)) {\n    return;\n  }\n  push.pushEvent(getActivedPage(), output);\n};\n\nexport const findPage = R.memoizeWith(R.toUpper, (identifier: string): any => {\n  const config = utils.getAppConfig();\n  return R.find(R.propEq(identifier, 'id'))(config.pages);\n});\n\nexport const getActivedPage = () => {\n  const pathname = utils.getPathname();\n  const page = findPage(pathname);\n  if (!page) {\n    return;\n  }\n  return page;\n};\n\nexport const getActivePageTag = () => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  return page.tag;\n};\n\nexport const getRuleOutput = (decode?: boolean) => {\n  const page = getActivedPage();\n  if (!page) {\n    return;\n  }\n  const { rules, tag, dynamicKeys = [] } = page;\n  const dynamicData = dynamic.getData(utils.getPathname());\n  const data = merge({}, dynamicData, tag, auth.getData(), infos.getData());\n  if (!isEmpty(dynamicKeys)) {\n    const keysOfCurrentPage = Object.keys(dynamicData);\n    const diff = R.difference(dynamicKeys, keysOfCurrentPage);\n    if (!R.isEmpty(diff)) {\n      console.warn('[page]missing dynamic keys', diff);\n    }\n  }\n  // pending runtime data\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n\n  return output;\n};\n","import * as R from 'ramda';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\nimport * as auth from './auth';\nimport * as infos from './infos';\nimport { isEmpty, merge, set } from 'lodash';\nimport * as push from './push';\n\nexport const runJob = ({ dataset = {}, classList, id }: any) => {\n  // get actived page\n  const page = pageble.getActivedPage();\n  if (!page) {\n    return;\n  }\n\n  // get actived button\n  const button = getTargetButton({ classList, id }, page);\n\n  if (!button) {\n    return;\n  }\n  // get page output, get button output\n  const resultOfPage = pageble.getRuleOutput() || {};\n  const resultOfButton = getRuleOutput(button, false, dataset);\n  const result = merge({}, resultOfPage, resultOfButton);\n\n  const data = {};\n  R.forEachObjIndexed((value, key) => {\n    set(data, key, value);\n  }, result);\n\n  push.pushEvent(button, data);\n};\n\nexport const getRuleOutput = (button: any, decode: boolean, dataset: any) => {\n  const { rules, tag, dynamicKeys = [] } = button;\n\n  if (!isEmpty(dynamicKeys)) {\n    const keysOfCurrentButton = Object.keys(dataset);\n    const diff = R.difference(dynamicKeys, keysOfCurrentButton);\n    if (!R.isEmpty(diff)) {\n      console.warn('[clickable]missing dynamic keys', diff);\n    }\n  }\n\n  const pageTag = pageble.getActivePageTag();\n  const data = merge(\n    {},\n    dataset,\n    pageTag,\n    tag,\n    auth.getData(),\n    infos.getData()\n  );\n  // pending runtime data\n  const flattenRules = utils.flattenKeys(rules);\n  const output = R.mapObjIndexed(value => {\n    return utils.replace(value, data);\n  }, flattenRules);\n\n  if (decode) {\n    const decodeOutput = {};\n    R.forEachObjIndexed((value, key) => {\n      set(decodeOutput, key, value);\n    }, output);\n    return decodeOutput;\n  }\n  return output;\n};\n\nexport const getTargetButton = (picture: any, page?: any) => {\n  if (!page) {\n    page = pageble.getActivedPage();\n  }\n  if (!page) {\n    return;\n  }\n  const button: any = R.find(\n    R.anyPass([\n      R.propEq(picture.id, 'id'),\n      R.propSatisfies(v => picture.classList?.contains(v), 'class'),\n    ])\n  )(page.actions.clicks);\n\n  if (!button) {\n    return;\n  }\n  return button;\n};\n","// import config from './config';\nimport { debounce } from 'lodash';\nimport * as clickable from './clickable';\nimport * as pageble from './pageble';\nimport * as utils from './utils';\n\nconst taggingRun = (__TaggingConfiguration: any) => {\n  if (__TaggingConfiguration) {\n    console.log('Tagging is running');\n    utils.setAppConfig(__TaggingConfiguration);\n    var pushState = window.history.pushState;\n    window.history.pushState = function() {\n      const beforeIdentifier = utils.getPathname(window.location);\n      pushState.apply(window.history, arguments as any);\n      const afterIdentifier = utils.getPathname(window.location);\n      if (beforeIdentifier !== afterIdentifier) {\n        debounce(pageble.runJob, 100)();\n      }\n    };\n\n    window.addEventListener('popstate', () => {\n      pageble.runJob();\n    });\n\n    document.addEventListener(\n      'click',\n      e => {\n        clickable.runJob(utils.getPictureFromDom(e.target));\n      },\n      true\n    );\n  }\n};\n\nexport default taggingRun;\n"],"names":["__TaggingConfiguration","flattenKeys","obj","path","isObject","_ref","join","reduce","cum","next","key","merge","concat","replace","str","replaceAll","_","a","split","b","c","getPictureFromDom","domTarget","dataset","_domTarget$classList","classList","id","getPathname","locationInstance","location","window","_getAppConfig","getAppConfig","hash","pathname","setAppConfig","config","getData","utils","auth","infos","dynamic","get","pushEvent","scope","data","_utils$getAppConfig","eventLabel","_utils$getAppConfig$p","pushTargets","set","eventName","type","targetPipe","Object","values","forEach","pushFn","pushFnWithArgs","Function","runJob","page","getActivedPage","isEmpty","dynamicKeys","output","getRuleOutput","push","findPage","R","identifier","pages","getActivePageTag","tag","decode","rules","_page$dynamicKeys","dynamicData","keysOfCurrentPage","keys","diff","console","warn","flattenRules","value","decodeOutput","_ref$dataset","pageble","button","getTargetButton","resultOfPage","resultOfButton","result","_button$dynamicKeys","keysOfCurrentButton","pageTag","picture","v","_picture$classList","contains","actions","clicks","taggingRun","log","pushState","history","beforeIdentifier","apply","arguments","afterIdentifier","debounce","addEventListener","document","e","clickable","target"],"mappings":"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"}