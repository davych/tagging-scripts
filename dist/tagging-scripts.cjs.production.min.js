"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n,t=require("lodash"),i=require("ramda"),e=function n(i,e){var r;return void 0===e&&(e=[]),t.isObject(i)?t.reduce(i,(function(i,r,a){return t.merge(i,n(r,[].concat(e,[a])))}),{}):((r={})[e.join(".")]=i,r)},r=function(n,t){return n.replaceAll(/\{([^}]+)\}/gi,(function(n,i){return i.split(".").reduce((function(n,t){return null==n?void 0:n[t]}),t)}))},a=function(n){var t=n||window.location;return o().hash?t.hash.replace("#",""):t.pathname},o=function(){return n},s=function(t){n=t},u=function(){return o().auth||{}},c=function(){return o().infos||{}},f={},d=function(n){return t.get(f,n,{})},v=function(n,i){var e=o(),r=e.eventLabel,a=e.pushTargets,s=void 0===a?{}:a;t.set(window,"__TAG_DATA__LAYER",i);var u=t.get(n,r,n.type||"event");Object.values(s).forEach((function(n){new Function("eventName","data",n)(u,i)}))},l=function(){var n=m();if(n&&t.isEmpty(null==n?void 0:n.dynamicKeys)){var i=y(!0);t.isEmpty(i)||v(n,i)}},p=i.memoizeWith(i.toUpper,(function(n){var t=o();return i.find(i.propEq(n,"id"))(t.pages)})),m=function(){var n=a(),t=p(n);if(t)return t},y=function(n){var o=m();if(o){var s=o.rules,f=o.tag,v=o.dynamicKeys,l=void 0===v?[]:v,p=d(a()),y=t.merge({},p,f,u(),c());if(!t.isEmpty(l)){var g=Object.keys(p),h=i.difference(l,g);i.isEmpty(h)||console.warn("[page]missing dynamic keys",h)}var w=e(s),E=i.mapObjIndexed((function(n){return n.startsWith("return")?new Function("data",n)(y):r(n,y)}),w);if(n){var b={};return i.forEachObjIndexed((function(n,i){t.set(b,i,n)}),E),b}return E}},g={__proto__:null,updateDynamicData:function(n){var i;!function(n,i){t.set(f,n,i)}(a(),n),i=y(!0),t.isEmpty(i)||v(m(),i)},updateAuth:function(i){!function(i){n.auth||(n.auth={}),t.merge(n.auth,i)}(i)},updateInfos:function(i){!function(i){n.infos||(n.infos={}),t.merge(n.infos,i)}(i)}};exports.default=function(n){if(n){console.log("Tagging is running"),s(n);var o=window.history.pushState;window.history.pushState=function(){var n=a(window.location);o.apply(window.history,arguments);var i=a(window.location);n!==i&&t.debounce(l,100)()},window.addEventListener("popstate",(function(){l()})),document.addEventListener("click",(function(n){var o,s;!function(n){var o=n.dataset,s=void 0===o?{}:o,f=n.classList,l=void 0===f?[]:f,p=n.id,g=m();if(g){var h=function(n,t){if(t||(t=m()),t&&t.actions&&t.actions.clicks){var e=i.find(i.anyPass([i.propEq(n.id,"id"),i.propSatisfies((function(t){var i;return null==(i=n.classList)?void 0:i.contains(t)}),"class")]))(t.actions.clicks);if(e)return e}}({classList:l,id:p},g);if(h){var w=y()||{},E=function(n,o,s){var f=n.rules,v=n.tag,l=n.dynamicKeys,p=void 0===l?[]:l;if(!t.isEmpty(p)){var y=Object.keys(s),g=i.difference(p,y);i.isEmpty(g)||console.warn("[clickable]missing dynamic keys",g)}var h=function(){var n=m();if(n)return n.tag}(),w=d(a()),E=t.merge({},w,s,h,v,u(),c()),b=e(f);return i.mapObjIndexed((function(n){return n.startsWith("return")?new Function("data",n)(E):r(n,E)}),b)}(h,0,s),b=t.merge({},w,E),_={};i.forEachObjIndexed((function(n,i){t.set(_,i,n)}),b),v(h,_)}}}((o=n.target,s=o.classList,{dataset:o.dataset,classList:void 0===s?[]:s,id:o.id}))}),!0)}},exports.tagHelpers=g;
//# sourceMappingURL=tagging-scripts.cjs.production.min.js.map
