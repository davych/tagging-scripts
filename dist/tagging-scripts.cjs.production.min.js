"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n,e=require("ramda"),t=require("lodash"),i=function n(e,i){var r;return void 0===i&&(i=[]),t.isObject(e)?t.reduce(e,(function(e,r,a){return t.merge(e,n(r,[].concat(i,[a])))}),{}):((r={})[i.join(".")]=e,r)},r=function(n,e){return n.replaceAll(/\{([^}]+)\}/gi,(function(n,t){return t.split(".").reduce((function(n,e){return null==n?void 0:n[e]}),e)}))},a=function(n){var e=n||window.location;return o().hash?e.hash.replace("#",""):e.pathname},o=function(){return n},s=function(e){n=e},c=function(){return o().auth||{}},u=function(){return o().infos||{}},d={},f=function(n,e){var i=o(),r=i.eventLabel,a=i.pushTargets,s=void 0===a?{}:a;t.set(window,"__TAG_DATA__LAYER",e);var c=t.get(n,r,n.type||"event");Object.values(s).forEach((function(n){new Function("eventName","data",n)(c,e)}))},v=function(){var n=p();if(n&&t.isEmpty(null==n?void 0:n.dynamicKeys)){var e=m(!0);t.isEmpty(e)||f(n,e)}},l=e.memoizeWith(e.toUpper,(function(n){var t=o();return e.find(e.propEq(n,"id"))(t.pages)})),p=function(){var n=a(),e=l(n);if(e)return e},m=function(n){var o=p();if(o){var s,f=o.rules,v=o.tag,l=o.dynamicKeys,m=(s=a(),t.get(d,s,{})),y=t.merge({},m,v,c(),u());if(!e.isEmpty(l)){var g=Object.keys(m),w=e.difference(l,g);e.isEmpty(w)||console.warn("[page]missing dynamic keys",w)}var h=i(f),E=e.mapObjIndexed((function(n){return r(n,y)}),h);if(n){var b={};return e.forEachObjIndexed((function(n,e){t.set(b,e,n)}),E),b}return E}};exports.default=function(n){if(n){console.log("Tagging is running"),s(n);var o=window.history.pushState;window.history.pushState=function(){var n=a(window.location);o.apply(window.history,arguments);var e=a(window.location);n!==e&&v()},window.addEventListener("popstate",(function(){v()})),document.addEventListener("click",(function(n){var a,o;!function(n){var a=n.dataset,o=void 0===a?{}:a,s=n.classList,d=n.id,v=p();if(v){var l=function(n,t){if(t||(t=p()),t){var i=e.find(e.anyPass([e.propEq(n.id,"id"),e.propSatisfies((function(e){var t;return null==(t=n.classList)?void 0:t.contains(e)}),"class")]))(t.actions.clicks);if(i)return i}}({classList:s,id:d},v);if(l){var y=m()||{},g=function(n,a,o){var s=n.rules,d=n.tag,f=n.dynamicKeys;if(!e.isEmpty(f)){var v=Object.keys(o),l=e.difference(f,v);e.isEmpty(l)||console.warn("[clickable]missing dynamic keys",l)}var m=function(){var n=p();if(n)return n.tag}(),y=t.merge({},o,m,d,c(),u()),g=i(s);return e.mapObjIndexed((function(n){return r(n,y)}),g)}(l,0,o),w=t.merge({},y,g),h={};e.forEachObjIndexed((function(n,e){t.set(h,e,n)}),w),f(l,h)}}}((a=n.target,o=a.classList,{dataset:a.dataset,classList:void 0===o?[]:o,id:a.id}))}),!0)}};
//# sourceMappingURL=tagging-scripts.cjs.production.min.js.map
