"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n,e=require("ramda"),i=require("lodash"),t=function n(e,t){var r;return void 0===t&&(t=[]),i.isObject(e)?i.reduce(e,(function(e,r,a){return i.merge(e,n(r,[].concat(t,[a])))}),{}):((r={})[t.join(".")]=e,r)},r=function(n,e){return n.replaceAll(/\{([^}]+)\}/gi,(function(n,i){return i.split(".").reduce((function(n,e){return null==n?void 0:n[e]}),e)}))},a=function(n){var e=n||window.location;return o().hash?e.hash.replace("#",""):e.pathname},o=function(){return n},s=function(e){n=e},c=function(){return o().auth||{}},u=function(){return o().infos||{}},d={},f=function(n,e){var t=o(),r=t.eventLabel,a=t.pushTargets,s=void 0===a?{}:a;i.set(window,"__TAG_DATA__LAYER",e);var c=i.get(n,r,n.type||"event");Object.values(s).forEach((function(n){new Function("eventName","data",n)(c,e)}))},v=function(){var n=p();if(n&&i.isEmpty(null==n?void 0:n.dynamicKeys)){var e=m(!0);i.isEmpty(e)||f(n,e)}},l=e.memoizeWith(e.toUpper,(function(n){var i=o();return e.find(e.propEq(n,"id"))(i.pages)})),p=function(){var n=a(),e=l(n);if(e)return e},m=function(n){var o=p();if(o){var s,f=o.rules,v=o.tag,l=o.dynamicKeys,m=void 0===l?[]:l,y=(s=a(),i.get(d,s,{})),g=i.merge({},y,v,c(),u());if(!i.isEmpty(m)){var w=Object.keys(y),h=e.difference(m,w);e.isEmpty(h)||console.warn("[page]missing dynamic keys",h)}var E=t(f),b=e.mapObjIndexed((function(n){return r(n,g)}),E);if(n){var j={};return e.forEachObjIndexed((function(n,e){i.set(j,e,n)}),b),j}return b}};exports.default=function(n){if(n){console.log("Tagging is running"),s(n);var o=window.history.pushState;window.history.pushState=function(){var n=a(window.location);o.apply(window.history,arguments);var e=a(window.location);n!==e&&v()},window.addEventListener("popstate",(function(){v()})),document.addEventListener("click",(function(n){var a,o;!function(n){var a=n.dataset,o=void 0===a?{}:a,s=n.classList,d=n.id,v=p();if(v){var l=function(n,i){if(i||(i=p()),i){var t=e.find(e.anyPass([e.propEq(n.id,"id"),e.propSatisfies((function(e){var i;return null==(i=n.classList)?void 0:i.contains(e)}),"class")]))(i.actions.clicks);if(t)return t}}({classList:s,id:d},v);if(l){var y=m()||{},g=function(n,a,o){var s=n.rules,d=n.tag,f=n.dynamicKeys,v=void 0===f?[]:f;if(!i.isEmpty(v)){var l=Object.keys(o),m=e.difference(v,l);e.isEmpty(m)||console.warn("[clickable]missing dynamic keys",m)}var y=function(){var n=p();if(n)return n.tag}(),g=i.merge({},o,y,d,c(),u()),w=t(s);return e.mapObjIndexed((function(n){return r(n,g)}),w)}(l,0,o),w=i.merge({},y,g),h={};e.forEachObjIndexed((function(n,e){i.set(h,e,n)}),w),f(l,h)}}}((a=n.target,o=a.classList,{dataset:a.dataset,classList:void 0===o?[]:o,id:a.id}))}),!0)}};
//# sourceMappingURL=tagging-scripts.cjs.production.min.js.map
