"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n,e=require("lodash"),i=require("ramda"),t=function n(i,t){var r;return void 0===t&&(t=[]),e.isObject(i)?e.reduce(i,(function(i,r,a){return e.merge(i,n(r,[].concat(t,[a])))}),{}):((r={})[t.join(".")]=i,r)},r=function(n,e){return n.replaceAll(/\{([^}]+)\}/gi,(function(n,i){return i.split(".").reduce((function(n,e){return null==n?void 0:n[e]}),e)}))},a=function(n){var e=n||window.location;return o().hash?e.hash.replace("#",""):e.pathname},o=function(){return n},s=function(e){n=e},c=function(){return o().auth||{}},u=function(){return o().infos||{}},d={},f=function(n,i){var t=o(),r=t.eventLabel,a=t.pushTargets,s=void 0===a?{}:a;e.set(window,"__TAG_DATA__LAYER",i);var c=e.get(n,r,n.type||"event");Object.values(s).forEach((function(n){new Function("eventName","data",n)(c,i)}))},v=function(){var n=p();if(n&&e.isEmpty(null==n?void 0:n.dynamicKeys)){var i=m(!0);e.isEmpty(i)||f(n,i)}},l=i.memoizeWith(i.toUpper,(function(n){var e=o();return i.find(i.propEq(n,"id"))(e.pages)})),p=function(){var n=a(),e=l(n);if(e)return e},m=function(n){var o=p();if(o){var s,f=o.rules,v=o.tag,l=o.dynamicKeys,m=void 0===l?[]:l,y=(s=a(),e.get(d,s,{})),g=e.merge({},y,v,c(),u());if(!e.isEmpty(m)){var w=Object.keys(y),h=i.difference(m,w);i.isEmpty(h)||console.warn("[page]missing dynamic keys",h)}var E=t(f),b=i.mapObjIndexed((function(n){return r(n,g)}),E);if(n){var j={};return i.forEachObjIndexed((function(n,i){e.set(j,i,n)}),b),j}return b}};exports.default=function(n){if(n){console.log("Tagging is running"),s(n);var o=window.history.pushState;window.history.pushState=function(){var n=a(window.location);o.apply(window.history,arguments);var i=a(window.location);n!==i&&e.debounce(v,100)()},window.addEventListener("popstate",(function(){v()})),document.addEventListener("click",(function(n){var a,o;!function(n){var a=n.dataset,o=void 0===a?{}:a,s=n.classList,d=n.id,v=p();if(v){var l=function(n,e){if(e||(e=p()),e){var t=i.find(i.anyPass([i.propEq(n.id,"id"),i.propSatisfies((function(e){var i;return null==(i=n.classList)?void 0:i.contains(e)}),"class")]))(e.actions.clicks);if(t)return t}}({classList:s,id:d},v);if(l){var y=m()||{},g=function(n,a,o){var s=n.rules,d=n.tag,f=n.dynamicKeys,v=void 0===f?[]:f;if(!e.isEmpty(v)){var l=Object.keys(o),m=i.difference(v,l);i.isEmpty(m)||console.warn("[clickable]missing dynamic keys",m)}var y=function(){var n=p();if(n)return n.tag}(),g=e.merge({},o,y,d,c(),u()),w=t(s);return i.mapObjIndexed((function(n){return r(n,g)}),w)}(l,0,o),w=e.merge({},y,g),h={};i.forEachObjIndexed((function(n,i){e.set(h,i,n)}),w),f(l,h)}}}((a=n.target,o=a.classList,{dataset:a.dataset,classList:void 0===o?[]:o,id:a.id}))}),!0)}};
//# sourceMappingURL=tagging-scripts.cjs.production.min.js.map
