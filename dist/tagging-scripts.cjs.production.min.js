"use strict";var n=require("ramda"),e=require("lodash"),t=function n(t,i){var a;return void 0===i&&(i=[]),e.isObject(t)?e.reduce(t,(function(t,a,r){return e.merge(t,n(a,[].concat(i,[r])))}),{}):((a={})[i.join(".")]=t,a)},i=function(n,e){return n.replaceAll(/\{([^}]+)\}/gi,(function(n,t){return t.split(".").reduce((function(n,e){return null==n?void 0:n[e]}),e)}))},a=function(n){var e=n||window.location;return r().hash?e.hash.replace("#",""):e.pathname},r=function(){return window.__TaggingConfiguration},o=function(){return r().auth||{}},s=function(){return r().infos||{}},c={},u=function(n,t){var i=r(),a=i.eventLabel,o=i.pushTargets,s=void 0===o?{}:o;e.set(window,"__TAG_DATA__LAYER",t);var c=e.get(n,a,n.type||"event");Object.values(s).forEach((function(n){new Function("eventName","data",n)(c,t)}))},d=function(){var n=f();if(n&&e.isEmpty(null==n?void 0:n.dynamicKeys)){var t=m(!0);e.isEmpty(t)||u(n,t)}},g=n.memoizeWith(n.toUpper,(function(e){return n.find(n.propEq(e,"id"))(window.__TaggingConfiguration.pages)})),f=function(){var n=a(),e=g(n);if(e)return e},m=function(r){var u=f();if(u){var d,g=u.rules,m=u.tag,l=u.dynamicKeys,v=(d=a(),e.get(c,d,{})),p=e.merge({},v,m,o(),s());if(!n.isEmpty(l)){var y=Object.keys(v),w=n.difference(l,y);n.isEmpty(w)||console.warn("[page]missing dynamic keys",w)}var h=t(g),_=n.mapObjIndexed((function(n){return i(n,p)}),h);if(r){var b={};return n.forEachObjIndexed((function(n,t){e.set(b,t,n)}),_),b}return _}};window.__TaggingConfiguration={name:"app-name",pushTargets:{gtm:"return dataLayer.push({event: eventName, ...data});"},eventLabel:"event",auth:{},infos:{region:"cn"},pages:[{tag:{name:"this-is-home",section:"footer"},name:"xxxxxxx",meta:{},id:"/page2",event:"page__view",type:"page",dynamicKeys:["aaa"],rules:{page:{pageName:"{name}:{region}",section:"{name}:{region}-{section}+{aaa}"}},actions:{clicks:[{tag:{buttonName:"hello-click"},type:"click",event:"button__click",meta:{},rules:{button:{buttonName:"{name}:{region}-{buttonName}:{cardname}"}},dynamicKeys:["cardname"],id:"domid",class:"domclass"}],toggle:[{tag:{},event:"toggle",id:"domid",class:"domclass",type:"toggle"}],errors:[{tag:{},event:"http_error",type:"http_error"},{tag:{},event:"form_error",id:"domid",class:"domclass",type:"form_error"}]}}]},function(){if(window.__TaggingConfiguration){console.log("Tagging is running");var r=window.history.pushState;window.history.pushState=function(){var n=a(window.location);r.apply(window.history,arguments);var e=a(window.location);n!==e&&d()},window.addEventListener("popstate",(function(){d()})),document.addEventListener("click",(function(a){var r,c;!function(a){var r=a.dataset,c=void 0===r?{}:r,d=a.classList,g=a.id,l=f();if(l){var v=function(e,t){if(t||(t=f()),t){var i=n.find(n.anyPass([n.propEq(e.id,"id"),n.propSatisfies((function(n){var t;return null==(t=e.classList)?void 0:t.contains(n)}),"class")]))(t.actions.clicks);if(i)return i}}({classList:d,id:g},l);if(v){var p=m()||{},y=function(a,r,c){var u=a.rules,d=a.tag,g=a.dynamicKeys;if(!n.isEmpty(g)){var m=Object.keys(c),l=n.difference(g,m);n.isEmpty(l)||console.warn("[clickable]missing dynamic keys",l)}var v=function(){var n=f();if(n)return n.tag}(),p=e.merge({},c,v,d,o(),s()),y=t(u);return n.mapObjIndexed((function(n){return i(n,p)}),y)}(v,0,c),w=e.merge({},p,y),h={};n.forEachObjIndexed((function(n,t){e.set(h,t,n)}),w),u(v,h)}}}((r=a.target,c=r.classList,{dataset:r.dataset,classList:void 0===c?[]:c,id:r.id}))}),!0)}}();
//# sourceMappingURL=tagging-scripts.cjs.production.min.js.map
