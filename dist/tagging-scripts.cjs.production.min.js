"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n,e=require("ramda"),t=require("lodash"),i=function n(e,i){var r;return void 0===i&&(i=[]),t.isObject(e)?t.reduce(e,(function(e,r,a){return t.merge(e,n(r,[].concat(i,[a])))}),{}):((r={})[i.join(".")]=e,r)},r=function(n,e){return n.replaceAll(/\{([^}]+)\}/gi,(function(n,t){return t.split(".").reduce((function(n,e){return null==n?void 0:n[e]}),e)}))},a=function(n){var e=n||window.location;return o().hash?e.hash.replace("#",""):e.pathname},o=function(){return n},s=function(e){n=e},c=function(){return o().auth||{}},u=function(){return o().infos||{}},d={},f=function(n,e){var i=o(),r=i.eventLabel,a=i.pushTargets,s=void 0===a?{}:a;t.set(window,"__TAG_DATA__LAYER",e);var c=t.get(n,r,n.type||"event");Object.values(s).forEach((function(n){new Function("eventName","data",n)(c,e)}))},l=function(){console.log("runJob-pageview");var n=p();if(console.log("getActivedPage runJob-pageview",n),n&&t.isEmpty(null==n?void 0:n.dynamicKeys)){var e=g(!0);console.log("output runJob-pageview",e),t.isEmpty(e)||f(n,e)}},v=e.memoizeWith(e.toUpper,(function(n){var t=o();return e.find(e.propEq(n,"id"))(t.pages)})),p=function(){var n=a();console.log("getActivedPage pathname",n);var e=v(n);if(console.log("findPage page",e),e)return e},g=function(n){var o=p();if(o){var s,f=o.rules,l=o.tag,v=o.dynamicKeys,g=(s=a(),t.get(d,s,{})),m=t.merge({},g,l,c(),u());if(!e.isEmpty(v)){var y=Object.keys(g),w=e.difference(v,y);e.isEmpty(w)||console.warn("[page]missing dynamic keys",w)}var h=i(f),b=e.mapObjIndexed((function(n){return r(n,m)}),h);if(n){var E={};return e.forEachObjIndexed((function(n,e){t.set(E,e,n)}),b),E}return b}};exports.default=function(n){if(n){console.log("Tagging is running"),s(n);var o=window.history.pushState;window.history.pushState=function(){var n=a(window.location);o.apply(window.history,arguments);var e=a(window.location);n!==e&&l()},window.addEventListener("popstate",(function(){l()})),document.addEventListener("click",(function(n){var a,o;!function(n){var a=n.dataset,o=void 0===a?{}:a,s=n.classList,d=n.id,l=p();if(l){var v=function(n,t){if(t||(t=p()),t){var i=e.find(e.anyPass([e.propEq(n.id,"id"),e.propSatisfies((function(e){var t;return null==(t=n.classList)?void 0:t.contains(e)}),"class")]))(t.actions.clicks);if(i)return i}}({classList:s,id:d},l);if(v){var m=g()||{},y=function(n,a,o){var s=n.rules,d=n.tag,f=n.dynamicKeys;if(!e.isEmpty(f)){var l=Object.keys(o),v=e.difference(f,l);e.isEmpty(v)||console.warn("[clickable]missing dynamic keys",v)}var g=function(){var n=p();if(n)return n.tag}(),m=t.merge({},o,g,d,c(),u()),y=i(s);return e.mapObjIndexed((function(n){return r(n,m)}),y)}(v,0,o),w=t.merge({},m,y),h={};e.forEachObjIndexed((function(n,e){t.set(h,e,n)}),w),f(v,h)}}}((a=n.target,o=a.classList,{dataset:a.dataset,classList:void 0===o?[]:o,id:a.id}))}),!0)}};
//# sourceMappingURL=tagging-scripts.cjs.production.min.js.map
