"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n,t=require("lodash"),e=require("ramda"),i=function n(e,i){var r;return void 0===i&&(i=[]),t.isObject(e)?t.reduce(e,(function(e,r,a){return t.merge(e,n(r,[].concat(i,[a])))}),{}):((r={})[i.join(".")]=e,r)},r=function(n,t){return n.replaceAll(/\{([^}]+)\}/gi,(function(n,e){return e.split(".").reduce((function(n,t){return null==n?void 0:n[t]}),t)}))},a=function(n){var t=n||window.location;return o().hash?t.hash.replace("#",""):t.pathname},o=function(){return n},u=function(t){n=t},s=function(){return o().auth||{}},c=function(){return o().infos||{}},f={},d=function(n){return t.get(f,n,{})},v=function(n,e){var i=o(),r=i.eventLabel,a=i.pushTargets,u=void 0===a?{}:a;t.set(window,"__TAG_DATA__LAYER",e);var s=t.get(n,r,n.type||"event");Object.values(u).forEach((function(n){new Function("eventName","data",n)(s,e)}))},l=function(){var n=m();if(n&&t.isEmpty(null==n?void 0:n.dynamicKeys)){var e=y(!0);t.isEmpty(e)||v(n,e)}},p=e.memoizeWith(e.toUpper,(function(n){var t=o();return e.find(e.propEq(n,"id"))(t.pages)})),m=function(){var n=a(),t=p(n);if(t)return t},y=function(n){var o=m();if(o){var u=o.rules,f=o.tag,v=o.dynamicKeys,l=void 0===v?[]:v,p=d(a()),y=t.merge({},p,f,s(),c());if(!t.isEmpty(l)){var g=Object.keys(p),h=e.difference(l,g);e.isEmpty(h)||console.warn("[page]missing dynamic keys",h)}var w=i(u),E=e.mapObjIndexed((function(n){return n.startsWith("return")?new Function("data",n)(y):r(n,y)}),w);if(n){var b={};return e.forEachObjIndexed((function(n,e){t.set(b,e,n)}),E),b}return E}},g={__proto__:null,updateDynamicData:function(n){var e;!function(n,e){t.set(f,n,e)}(a(),n),e=y(!0),t.isEmpty(e)||v(m(),e)},updateAuth:function(e){!function(e){n.auth||(n.auth={}),t.merge(n.auth,e)}(e)},updateInfos:function(e){!function(e){n.infos||(n.infos={}),t.merge(n.infos,e)}(e)}};exports.default=function(n){if(n){console.log("Tagging is running"),u(n);var o=window.history.pushState;window.history.pushState=function(){var n=a(window.location);o.apply(window.history,arguments);var e=a(window.location);n!==e&&t.debounce(l,100)()},window.addEventListener("popstate",(function(){l()})),document.addEventListener("click",(function(n){var o,u;!function(n){var o=n.dataset,u=void 0===o?{}:o,f=n.classList,l=void 0===f?[]:f,p=n.id,g=m();if(g){var h=function(n,t){if(t||(t=m()),t){var i=e.find(e.anyPass([e.propEq(n.id,"id"),e.propSatisfies((function(t){var e;return null==(e=n.classList)?void 0:e.contains(t)}),"class")]))(t.actions.clicks);if(i)return i}}({classList:l,id:p},g);if(h){var w=y()||{},E=function(n,o,u){var f=n.rules,v=n.tag,l=n.dynamicKeys,p=void 0===l?[]:l;if(!t.isEmpty(p)){var y=Object.keys(u),g=e.difference(p,y);e.isEmpty(g)||console.warn("[clickable]missing dynamic keys",g)}var h=function(){var n=m();if(n)return n.tag}(),w=d(a()),E=t.merge({},w,u,h,v,s(),c()),b=i(f);return e.mapObjIndexed((function(n){return n.startsWith("return")?new Function("data",n)(E):r(n,E)}),b)}(h,0,u),b=t.merge({},w,E),_={};e.forEachObjIndexed((function(n,e){t.set(_,e,n)}),b),v(h,_)}}}((o=n.target,u=o.classList,{dataset:o.dataset,classList:void 0===u?[]:u,id:o.id}))}),!0)}},exports.tagHelpers=g;
//# sourceMappingURL=tagging-scripts.cjs.production.min.js.map
